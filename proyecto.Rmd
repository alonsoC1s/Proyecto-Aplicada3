---
title: "Proyecto"
output:
  pdf_document:
    latex_engine: xelatex
    toc: true
    pandoc_args: [--biblatex]
  html_document: default
date: '2022-05-10'
bibliography: refs.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = F, message = F, fig.align = "center")
library(ggplot2)
library(corrplot)
library(dplyr)
library(stargazer)
```

## R Markdown

Cargamos los datos:

```{r}
info <- read.csv('data/datosfinales.csv')
```

## Planteamiento del problema

La Ciudad de México es una de las 10 ciudades más grandes del mundo por
población con `r info |> dplyr::filter(AÑO == 2020) |> summarize(sum(POBLACION))
as.numeric() |> format(big.mark=",")` habitantes al 2020, sin contar la zona
metropolitana que incluye zonas del Estado de México e Hidalgo.  Una población
de este tamaño exige un sistema de transporte público masivo de alta frecuencia,
volumen y disponibilidad. El sistema de transporte público unificado en la
Ciudad de México es en nuestra opinión uno relativamente bien planeado y
accesible. Sin embargo, como personas que no vivimos en la periferia de la zona
metropolitana nuestras opiniones pueden estar sesgadas.

El objetivo de esta investigación es cuantificar el nivel de acceso de la
población de distintas alcaldías de la ciudad a los diversos medios de
transporte público masivo. Como transporte público masivo estamos tomando en
cuenta los siguientes servicios de transporte unificado que ofrece la ciudad:

- Metro
- Metrobus
- Tren Ligero
- Cablebus

Elegimos concentrarnos en estos servicios por las siguientes características:

1. Frecuencia. La frecuencia con la que pasan nuevos convoyes debe ser
  relativamente alta. Por ejemplo, en horas pico pasan convoyes nuevos de metro y
  metrobus en pocos minutos.

2. Volumen. Nos concentramos en transportes de alto volumen, excluyendo peseros y microbuses.

3. Unificado. Nos concentramos en el sistema de transporte unificado coordinado
  por el gobierno de la Ciudad de México.

Además de hacer una exploración el objetivo de esta investigación es determinar
que tan bien distribuido está el transporte público en la ciudad. Como
habitantes de la CDMX tenemos la sospecha de que el transporte público está muy
centralizado en la zona del centro histórico. Es decir, sospechamos que el
sistema de transporte público privilegia a las personas que viven en las
delegaciones como Benito Juárez, Cuauhtémoc, etc... que no son necesariamente
las delegaciones con las poblaciones más altas.

Estas relaciones las exploraremos mediante diversas técnicas cubiertas en el
curso. Primero que nada procedemos con análisis exploratorio para empezar a
ganar intuición sobre el conjunto de datos. Más tarde aplicamos técnicas
estadísticas para construir algo como un "índice de conectividad". Exploramos
cómo se relaciona este índice con variables de interés como: centralidad medida
en distancia a la zona del centro histórico, población, y otros factores.

## Análisis exploratorio

```{R}
info |> head()
summary(info)
```

Hay 16 alcaldías. Cada alcaldía contiene datos de población y conectividad con
el transporte público desde el año 1969 hasta el 2021.

Para el análisis que vamos a llevar a cabo recabamos información de diversas
fuentes para indicadores de movilidad para las alcaldías de la CDMX y cómo han
evolucionado desde principios de la década de los 70.

Tenemos información para `r length(unique(info$ALCALDIA))` alcaldías, las cuales
son:
```{R}
unique(info$ALCALDIA) # |> pprint()
```

Tenemos información para los siguientes años:
```{R}
unique(info$AÑO)
```

Primero que nada, vemos algunas estadísticas de resumen de los datos.

```{R}
summary(info)
```

## Descripción de las variables de interés
Las variables son las siguientes:

- AÑO: El año en el cual están medidas las variables.
- ALCALDIA: La demarcación territorial de delegación o Alcaldía al que
  corresponden los datos.
- POBLACIÓN: La población para cada alcaldía en el año dado.
- MEAN_DIST: La distancia promedio de todas las zonas marcadas como
  residenciales en la encuesta de uso de suelo a su estación de transporte público
  masivo más cercano medida en metros.
- EST_TOTAL: Número total de estaciones de transporte público masivo en la
  alcaldía al año marcado.
- ZOC_DIST: Distancia promedio de las zonas residenciales al zócalo de la
  ciudad.

Las variables fueron construidas a partir de diferentes conjuntos de datos
abiertos al público. No encontramos una base de datos que tuviera lista para
usarse toda la información que era necesaria para el análisis, menos aún como
función del tiempo. En las siguientes secciones ahondamos en algunos detalles
técnicos de cómo se obtuvieron, limpiaron, y trabajaron datos faltantes. 

### Número total de estaciones por delegación
Para encontrar el número de estaciones de transporte público masivo por
delegación a un año dado utilizamos los conjuntos de datos \cite{metrobus,
metro, corredorverde}. En la figura [] se pueden ver todas las líneas de transporte público consideradas sobr el mapa de la CDMX con división política. 

```{R, echo=FALSE}
alc <- read_sf("data/alcaldias_cdmx/alcaldías_cdmx/alcaldias_cdmx.shp")
UP <- c("MILPA ALTA", "BENITO JUÁREZ", "GUSTAVO A. MADERO", "COYOACÁN",
"MIGUEL HIDALGO", "LA MAGDALENA CONTRERAS", "TLÁHUAC", "AZCAPOTZALCO",
"IZTACALCO", "ÁLVARO OBREGÓN", "XOCHIMILCO", "VENUSTIANO CARRANZA", "TLALPAN",
"CUAJIMALPA DE MORELOS", "CUAUHTÉMOC", "IZTAPALAPA")
dw <- c("Milpa Alta", "Benito Juárez", "Gustavo A. Madero", "Coyoacán",
"Miguel Hidalgo", "Magdalena Contreras", "Tláhuac", "Azcapotzalco", "Iztacalco", "Álvaro Obregón", "Xochimilco", "Venustiano Carranza", "Tlalpan", "Cuajimalpa",
"Cuauhtémoc", "Iztapalapa")

alc <- alc |>
  dplyr::mutate(nomgeo = case_when(
    x == "MILPA ALTA"~"Milpa Alta",
    x == "BENITO JUÁREZ"~"Benito Juárez",
    x == "GUSTAVO A. MADERO"~"Gustavo A. Madero",
    x == "COYOACÁN"~"Coyoacán",
    x == "MIGUEL HIDALGO"~"Miguel Hidalgo",
    x == "LA MAGDALENA CONTRERAS"~"Magdalena Contreras",
    x == "TLÁHUAC"~"Tláhuac",
    x == "AZCAPOTZALCO"~"Azcapotzalco",
    x == "CUAJIMALPA DE MORELOS"~"Cuajimalpa",
    x == "CUAUHTÉMOC"~"Cuauhtémoc", 
  ))
```

```{R, echo=FALSE}
mb <- read_sf("data/mb_shp/Metrobus_lineas_rutas_utm14n.shp")
metro <- read_sf("data/stcmetro_shp/STC_Metro_lineas_utm14n.shp")
tlig <- read_sf("data/ste_tren_ligero_shp/STE_TrenLigero_linea_utm14n.shp")
cbus <- read_sf("data/ste_cablebus_shp/STE_Cablebus_lineas_utm14n.shp")

ggplot(mapping = aes(color = SISTEMA)) +
  geom_sf(data = alc, color="gray") +
  geom_sf(data = mb) +
  geom_sf(data = metro) +
  geom_sf(data = tlig) +
  geom_sf(data = cbus) +
  labs(
    title = "Lineas del Servicio de Transporte Unificado",
  )
```

```{R, echo=FALSE}
ggplot(data = alc) +
  geom_sf(aes(fill = nomgeo), show.legend=FALSE) +
  geom_sf_label(aes(label = nomgeo))
```

* Podemos ver que las alcaldías de Cuauhtémoc, Benito Juárez y Venustiano Carranza tienen las menores varianzas en distancia media y además las más pequeñas. Por otro lado, Tláhuac y Milpa Alta son los de mayor distancia y desviación.
```{R, echo=FALSE}
ggplot(data = info, mapping=aes(x=ALCALDIA, y=MEAN_DIST, fill=ALCALDIA)) +
  geom_boxplot() + 
  coord_flip() + 
  labs(
    title = "Distancia promedio al transporte más cercano por alcaldía",
    x = "Año",
    y = "Distancia al transporte en metros"
  )
```

```{R, echo=FALSE}
ggplot(data = info, mapping=aes(x=ALCALDIA, y=EST_TOTAL, fill=ALCALDIA)) +
  geom_boxplot() + 
  coord_flip() + 
  labs(
    title = "Total de estaciones por alcaldía a través del tiempo.",
    x = "Año",
    y = "Total de estaciones"
  )
```

```{R, echo=FALSE}
info |>
  dplyr::select_if(is.numeric) |>
  dplyr::filter(!is.na(EST_TOTAL)) |>
  dplyr::filter(!is.na(MEAN_DIST)) |>
  dplyr::filter(!is.na(ZOC_DIST)) |>
  #dplyr::select(-POBLACION) |>
  cor() |> corrplot(method="ellipse", tl.cex=0.75)
```

```{r, echo=FALSE}
ggplot(data=info, mapping=aes(x=AÑO, y=POBLACION, color=ALCALDIA)) +
  geom_line() + 
  labs(
    title = "Población por alcaldía por año",
    x = "Año",
    y = "Población"
  )
```


## PCA

## Correlación canónica

## Analisis Factorial

### Pruebas de hipótesis

## Regresión lineal

## Interpretación, conclusiones, etc...
